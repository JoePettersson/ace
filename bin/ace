#!/usr/bin/env node

var path = require('path'),
    fs   = require('fs'),
    argv = process.argv.slice(2),
    App  = require('../lib/index').App;

// Use local ace module if available
if (fs.existsSync('./node_modules/.bin/ace')) {
  return require('module')._load('./node_modules/.bin/ace');
}

try {
  require('coffee-script');
} catch(e) { }

filename = argv[0];

if ( !filename ) {
  try {
    filename = require.resolve('./index');
  } catch (e) {}
}

if ( !filename ) {
  try {
    filename = require.resolve('./app');
  } catch (e) {}
}

if ( !filename ) {
  console.log("Ace usage:");
  console.log("\tace PATH");
  return;
}

filename = path.resolve(filename);
process.chdir(path.dirname(filename));

var app = new App;
global.app = app;
require(filename);
app.serve();